"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1817],{1804:function(e,t,n){n.d(t,{o:function(){return u}});var r=n(27573),a=n(8571),i=n(27218),s=n(88146),o=n(45790);let l=()=>{let e=(0,a.Z)(),{websiteBaseUrl:t}=(0,a.m)();return e?(0,r.jsx)(o.Z,{defaultMessage:"Or consider <link>upgrading to Claude Pro</link>.",id:"j0jOXOpUyS",values:{link:e=>(0,r.jsx)("a",{href:"/upgrade/pro",className:"font-bold underline",rel:"noreferrer",children:e})}}):(0,r.jsx)(o.Z,{defaultMessage:"Or <link>contact sales</link> if you would be interested in upgrading to a paid version of Claude.",id:"3hk4yMCf5v",values:{link:e=>(0,r.jsx)(s.default,{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:e})}})};function u(){let e=(0,i.w7)(),t=(0,i.uh)();return e&&!t?(0,r.jsx)(l,{}):null}},71817:function(e,t,n){n.d(t,{hH:function(){return J},wN:function(){return $},Qk:function(){return et},pV:function(){return G},lE:function(){return U}});var r,a,i,s,o=n(27573),l=n(28803),u=n(1804),c=n(3053),d=n(8571),h=n(27218),p=n(27895),m=n(66092),_=n(72358),f=n(30947),g=n(6385),k=n(66894),v=n(13262),x=n(87033),y=n(51432),b=n(45144),w=n(58183),C=n(77930),S=n(5068),E=n(43290),j=n(88146),L=n(81695),I=n(7653),O=n(45790),M=n(40950),T=n(41270),D=n(8073),N=n(58884);let P=(e,t)=>t.reduce((t,n)=>t+e.blockSize(n),0),R=(e,t,n)=>{let{blockSize:r,sliceBlock:a}=e,i=[];if(n<=0)return[];let s=0;for(let e of t){if(s+r(e)>=n){i.push(a(e,n-s));break}i.push(e),s+=r(e)}return i},B=1e3/60;class A{_get_smoothed_completion(){var e,t,n;if(0===this.start)return[];let r=(Date.now()-this.start)/1e3,a=this.arrivals[this.arrivals.length-1][1]+(this.model_done?100:0),i=.9*r-(null!==(n=null===(e=(t=this.blockOperations).getBlockDeadlineOffset)||void 0===e?void 0:e.call(t))&&void 0!==n?n:.3),s=this.arrivals.filter(e=>e[0]<i).map(e=>e[1]),o=s[s.length-1],l=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let a=e(t),i=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(a>r)throw Error("Lower f is greater than zero");if(i<-r)throw Error("Upper f is less than zero");for(;a<-r;){let r=(t+n)/2,s=e(r);s<=0?(t=r,a=s):(n=r,i=s)}return t}(e=>{let t=(e-this.x)/(r-this.t),n=1/(r-this.t);return 2*this.gamma*n*(t-this.v)-1/(e-o)+1/(a-e)},o,a),u=(l-this.x)/(r-this.t);return this.v=this.alpha*this.v+(1-this.alpha)*u,this.smoothed_completion_is_unchanged=this.x>=this.totalCompletionLength,this.x=Math.max(l,this.x),this.t=r,this.stats.push({t:r,x:l,v:u,min_chars:o,max_chars:a}),R(this.blockOperations,this.blocksList,this.x)}get smootherDone(){return this.force_smoother_done||this.model_done&&this.x>=this.totalCompletionLength}addBlock(e,t){this.blocksList.push(t)}updateBlock(e,t){this.blocksList[e]=t}getBlocks(){return this.blocksList}onMessage(e){switch(e.type){case"content_block_start":{let t=this.blockOperations.createBlockFromStartEvent(e);null!==t&&this.addBlock(e.index,t);break}case"content_block_delta":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.applyDeltaEvent(e,t);this.updateBlock(e.index,n);break}case"content_block_stop":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.stopBlockEvent(e,t);this.updateBlock(e.index,n);break}case"message_stop":this.model_done=!0}0===this.start&&(this.start=Date.now());let t=P(this.blockOperations,this.blocksList);if(this.totalCompletionLength=t,this.arrivals.push([(Date.now()-this.start)/1e3,t]),this.dont_smooth&&this.on_completion){let e=structuredClone(this.blocksList);this.on_completion(e)}}async task(e,t){for(;!this.smootherDone&&!t.aborted;){if(this.blocksList.length>0){let t=this._get_smoothed_completion();this.smoothed_completion_is_unchanged||e(t)}await new Promise(e=>setTimeout(e,B))}}constructor(e){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.totalCompletionLength=0,this.smoothed_completion_is_unchanged=!1,this.dont_smooth=!1,this.model_done=!1,this.force_smoother_done=!1,this.stats=[],this.blocksList=[],this.blockOperations=e}}(r=i||(i={}))[r.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",r[r.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",(a=s||(s={})).Ping="ping",a.Completion="completion",a.Error="error",a.ContentBlockDelta="content_block_delta",a.ContentBlockStart="content_block_start",a.ContentBlockStop="content_block_stop",a.MessageDelta="message_delta",a.MessageStart="message_start",a.MessageStop="message_stop",a.MessageLimit="message_limit";let Q=["close_file","create_file","delete_file","file_search","open_file","repl","str_replace","update_file"];async function Z(e){let t,n,{applicationType:r,endpoint:a,orgUuid:i,conversationUuid:s,body:o,onCompletion:l,onInvokeTool:u,abortController:c,completion:d,getTools:h,smoothingEnabled:p=!0}=e,m=(t={},n=!1,new A({blockSize:e=>{if("text"===e.type)return e.text.length;if("thinking"===e.type)return e.thinking.length;if("tool_use"===e.type){var t;return(null===(t=e.partial_json)||void 0===t?void 0:t.length)||0}return e.type,0},sliceBlock:(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null===(n=e.partial_json)||void 0===n?void 0:n.slice(0,t)}}return"thinking"===e.type?{...e,thinking:e.thinking.slice(0,t)}:e},createBlockFromStartEvent:e=>("thinking"===e.content_block.type&&(e.content_block.start_timestamp=new Date().toISOString()),e.content_block),applyDeltaEvent:(e,r)=>{var a,i;switch(r.type){case"text":switch(n=!1,e.delta.type){case"text_delta":return{...r,text:r.text+e.delta.text};case"citation_start_delta":{let n=e.delta.citation;return t={...t,[n.uuid]:{...n,start_index:r.text.length}},r}case"citation_end_delta":{let n=e.delta.citation_uuid;return{...r,citations:(null!==(a=r.citations)&&void 0!==a?a:[]).concat({...t[n],end_index:r.text.length})}}default:return r}case"thinking":switch(n=!0,e.delta.type){case"thinking_delta":return{...r,thinking:r.thinking+e.delta.thinking};case"thinking_summary_delta":return{...r,summaries:[...r.summaries||[],e.delta.summary]};case"thinking_cut_off_delta":return{...r,cut_off:e.delta.cut_off};default:return r}case"tool_result":if(n=!1,"input_json_delta"===e.delta.type)return{...r,content:[{type:"text",text:e.delta.partial_json}]};return r;case"tool_use":if(n=!1,"input_json_delta"===e.delta.type)return{...r,partial_json:(null!==(i=r.partial_json)&&void 0!==i?i:"")+e.delta.partial_json};return r}},stopBlockEvent:(e,t)=>"thinking"===t.type?{...t,stop_timestamp:e.stop_timestamp}:t,getBlockDeadlineOffset(){if(n)return 3}}));m.dont_smooth=!p,m.on_completion=l;let _=p?m.task(l,c.signal):Promise.resolve(),g={"Content-Type":"application/json",Accept:"text/event-stream",...(0,D.F)(r)},k=null,v=null,x=JSON.stringify({...d,...o,text:void 0,rendering_mode:"messages",organization_uuid:void 0,conversation_uuid:void 0}),y="",w="",C="",S=0,E=(0,N.L)(function(e,t,n){let r;if(void 0===t||void 0===n)throw Error("Missing org uuid or conversation uuid");switch(e){case 1:r="completion";break;case 2:r="retry_completion";break;default:throw Error("Invalid endpoint")}return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/").concat(r)}(a,i,s),{method:"POST",credentials:"include",headers:g,body:x,openWhenHidden:!0,signal:c.signal,async onopen(e){var t;if(!e.ok||!(null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes(N.a))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,f.fT)(e.status,n,"Failed to fetch",e.headers)}},onmessage:e=>{var t,n;switch(e.event){case"ping":default:return;case"error":throw(0,f.fT)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let n=JSON.parse(e.data);if(void 0===n.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let r={type:"content_block_delta",index:0,delta:{type:"text_delta",text:n.completion}};k=n.stop_reason,v=null!==(t=n.messageLimit)&&void 0!==t?t:null,m.onMessage(r);break}case"content_block_start":{let t=JSON.parse(e.data);S=t.index,"tool_use"===t.content_block.type&&(w=t.content_block.name,C=t.content_block.id),m.onMessage(t);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==S&&"thinking_summary_delta"!==t.delta.type)throw Error("Content block index did not match the expected index");(null===(n=t.delta)||void 0===n?void 0:n.type)==="input_json_delta"&&(Q.includes(w)||h().some(e=>e.name===w))&&(y+=t.delta.partial_json),m.onMessage(t);break}case"content_block_stop":{let t=JSON.parse(e.data);if(t.index!==S)throw Error("Content block index did not match the expected index");if(m.onMessage(t),!w)break;u(s,w,C,y),y="",w="",C="";break}case"message_limit":v=JSON.parse(e.data).message_limit;break;case"message_delta":case"message_start":case"message_stop":{let t=JSON.parse(e.data);"message_stop"===t.type&&(k="message_stop"),m.onMessage(t)}}},onclose(){m.model_done=!0},onerror(e){throw e instanceof f.Hx&&529===e.statusCode||(0,b.Tb)(e),m.model_done=!0,m.force_smoother_done=!0,e}});return await Promise.all([E,_]),{stopReason:k,messageLimitResult:v}}var H=n(1146),z=n(78230),F=n(49185),W=n(57271);let Y=(0,I.createContext)([null,null]);function J(e){let{children:t}=e,n=(0,I.useState)({});return(0,o.jsx)(Y.Provider,{value:n,children:t})}function G(e,t,n){let{compassLightEnabled:r}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{onIncrementalCompletion:a,onStartAppend:s,onStreamCompleted:o}=(0,W.p)(),l=en({conversationUUID:e,endpoint:i.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:a,onStreamCompleted:o,onInvokeTool:t,getTools:n}),{runStream:u}=l,c=(0,I.useCallback)(async t=>{let{prompt:n,attachments:a,files:i,syncSources:o,rethrowErrors:l=!1,modelOverride:c,parent_message_uuid:d,personalized_style:h,compass_light:p,org_type_override:m}=t;await s(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,H.HX)(e),r=[{uuid:H.wZ,content:[{type:"text",text:n,citations:[]}],created_at:new Date().toISOString(),sender:"human",attachments:a,files:i,files_v2:i,sync_sources:o,index:t+1,parent_message_uuid:null!=d?d:H.QC},{uuid:H.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],index:t+2,parent_message_uuid:H.wZ,metadata:{light_research:p}}];return(0,H.vv)(e,r)}),await u({prompt:n,attachments:a,files:i,syncSources:o,rethrowErrors:l,modelOverride:c,parent_message_uuid:d,personalized_style:h,compass_light:r||p,org_type_override:m})},[u,s,e,r]);return{...l,runStream:c}}function U(e,t,n,r){let{compassLightEnabled:a}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},{onIncrementalCompletion:s,onStreamCompleted:o,onStartAppend:l}=(0,W.p)(),u=en({conversationUUID:e,endpoint:i.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:s,onInvokeTool:t,onStreamCompleted:o,getTools:n}),{runStream:c}=u,d=(0,I.useCallback)(async(t,n)=>{await l(e,e=>{let n=[{uuid:H.FC,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],parent_message_uuid:t,selectedOption:0,index:(0,H.HX)(e)+1}];return(0,H.vv)(e,n)}),await c({prompt:"",attachments:[],files:[],syncSources:[],parent_message_uuid:t,personalized_style:r,paprika_mode:n,isRetry:!0,compass_light:a})},[e,c,l,r,a]);return{...u,runStream:d}}let X="incomplete_stream",q=Error(X),K=T.z.object({model:T.z.string().nullable()}).nullable(),$=e=>{let t=V(e),n=(0,x.EH)("tepui_default_on_claude_free","model",null,x.rO),r=(0,x.PQ)("console_default_model_override","model",null,K),a=(0,x.Zr)("console_default_model","model",null,x.rO);return t||n||(null==r?void 0:r.model)||a||"claude-2.1"},V=e=>{let t=(0,l.cE)(e||""),n=(0,L.useSearchParams)(),r=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:r||void 0},ee={value:null},et=()=>{let e=(0,C.useQueryClient)();return{failedStreamRetryData:(0,S.useQuery)({queryKey:[v.sf],queryFn:()=>ee.value,initialData:null}).data||null,setFailedStreamRetryData:(0,I.useCallback)(t=>{ee.value=t,e.setQueryData([v.sf],t)},[e])}};function en(e){var t;let{conversationUUID:n,endpoint:r,getTools:a,onIncrementalCompletion:i,onInvokeTool:s,onStreamCompleted:v}=e,{applicationType:C}=(0,d.m)(),{activeOrganization:S}=(0,h.t)(),{value:T}=(0,x.FL)("apps_no_smoothing"),D=null==S?void 0:S.uuid,{getRemoteMcpTools:N}=(0,m.$)(),{context:P,clearContext:R,setContext:B}=function(e){let[t,n]=(0,I.useContext)(Y),[r,a]=(0,I.useState)(),i=(0,I.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):a(void 0)},[e,n]),s=(0,I.useCallback)(t=>{n?n(n=>({...n,[e]:t})):a(t)},[e,n]);return{context:t?t[e]:r,clearContext:i,setContext:s}}(n),A=(0,L.useSearchParams)(),Q=null==A?void 0:A.get("t"),H=null!==(t=V(n))&&void 0!==t?t:"",W=null==A?void 0:A.get("max_tokens"),J=(0,F.n)(),{addError:G,clearToast:U}=(0,p.e)(),K=(0,I.useMemo)(y.H,[]),$=(0,l.$H)("push",K),{setFailedStreamRetryData:ee}=et(),en=(0,I.useCallback)(async e=>{await (null==v?void 0:v(n,e)),R()},[v,n,R]),er=(0,I.useCallback)((e,t,r)=>{if(e===X)return G((0,o.jsx)("p",{children:(0,o.jsx)(O.Z,{defaultMessage:"Claude’s response was interrupted. Please check your network connection or <link>contact support</link> if the issue persists.",id:"C83ex9tIjX",values:{link:e=>(0,o.jsx)(j.default,{href:"https://support.anthropic.com/en/articles/9015913-how-to-get-support",className:"underline",children:e})}})}));if(!(e instanceof f.Hx))return G((0,o.jsx)(O.Z,{defaultMessage:"We couldn’t connect to Claude. Please check your network connection and try again.",id:"KzO0j4cGtg"}));if("rate_limit_error"===e.type){if(e.message.includes("{")&&D)try{let t=JSON.parse(e.message);J(t,D,n)}catch(e){}return G((0,o.jsxs)("p",{children:[(0,o.jsx)(O.Z,{defaultMessage:"You’ve reached the limit for Claude messages at this time. Please wait before trying again.",id:"CBMEJMlMzs"}),"\xa0",(0,o.jsx)(u.o,{})]}))}if("not_found_error"===e.type)return G((0,o.jsx)(O.Z,{defaultMessage:"Claude model version not found.",id:"kdrUaXpTqd"}));if("billing_error"===e.type)return G((0,o.jsx)("p",{children:(0,o.jsx)(O.Z,{defaultMessage:"We had an unexpected billing error, please <link>contact support.</link>",id:"MBYn4HHrFu",values:{link:e=>(0,o.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/9015913-how-can-i-contact-support",target:"_blank",rel:"noreferrer",children:e})}})}));if("overloaded_error"===e.type)return G((0,o.jsxs)("p",{children:[(0,o.jsx)(O.Z,{defaultMessage:"Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",id:"TRpxX8Mu1L"}),"\xa0",(0,o.jsx)(u.o,{})]}));if("exceeded_max_uploads_per_message"===e.errorCode){G((0,o.jsx)(O.Z,{defaultMessage:"Your message will exceed the maximum number of files allowed per message. Consider removing some of your files or adding files over several messages.",id:"/jNwaAHdg9"}));return}if("exceeded_max_image_limit_per_chat"===e.errorCode){let e=G((0,o.jsx)("p",{children:r>0?(0,o.jsx)(O.Z,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try uploading {count, plural, one {# document} other {# documents}} with fewer pages, removing images, <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"gltmHPfviz",values:{link:e=>(0,o.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g._R,children:e}),newChatLink:t=>(0,o.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),$(),U(e)},children:t}),upgradeInstructions:()=>(0,o.jsx)(u.o,{}),count:r}}):(0,o.jsx)(O.Z,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try removing images <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"QmLhKBubcc",values:{link:e=>(0,o.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g._R,children:e}),newChatLink:t=>(0,o.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),$(),U(e)},children:t}),upgradeInstructions:()=>(0,o.jsx)(u.o,{})}})}));return}if("invalid_request_error"===e.type&&413===e.statusCode){let e=G((0,o.jsx)("p",{children:t>0?(0,o.jsx)(O.Z,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try attaching fewer or smaller files <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"G1lejdsk5p",values:{link:e=>(0,o.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g.jC,children:e}),newChatLink:t=>(0,o.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),$(),U(e)},children:t}),upgradeInstructions:()=>(0,o.jsx)(u.o,{})}}):(0,o.jsx)(O.Z,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try shortening your message <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"EWtBrIlAAR",values:{link:e=>(0,o.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:g.jC,children:e}),newChatLink:t=>(0,o.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),$(),U(e)},children:t}),upgradeInstructions:()=>(0,o.jsx)(u.o,{})}})}));return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?G((0,o.jsx)("p",{children:(0,o.jsx)(O.Z,{defaultMessage:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while.",id:"W2dIBW8oIg"})})):G(e)},[G,D,J,n,$,U]),ea=(0,c.z$)(),ei=(0,w.useExperiment)("no_more_smoother"),es=(0,M.Z)(),eo=(0,I.useCallback)(async e=>{let{prompt:t,attachments:o,files:l,syncSources:u,rethrowErrors:c=!1,modelOverride:d,parent_message_uuid:h,personalized_style:p,isRetry:m=!1,paprika_mode:f,compass_light:g,org_type_override:v}=e;if(P)return;if(!S)throw Error("Cannot stream without an organization");let x=new AbortController;B({controller:x}),ee(null);let y={prompt:t,parent_message_uuid:h,timezone:E.ou.local().zoneName||void 0,personalized_styles:p?[p]:void 0,locale:_.Yr.includes(es.locale)?es.locale:_.ZW},w=(0,z.l)();w&&(y.custom_system_prompt=w),H&&"string"==typeof H&&(y.model=H),d&&(y.model=d),"string"==typeof Q&&(y.temperature=parseInt(Q)),W&&"string"==typeof W&&(y.max_tokens_to_sample=parseInt(W)),m&&f&&(y.paprika_mode=f),g&&(y.research_lite=!0);let j=a();j.length&&(y.tools=j);let L=N();L.length>0&&(y.tools=[...j,...L]);let I=[],O=null,M=null,D=null;try{let e=ei.get("no_smoothing",!1);if(O=(D=await Z({applicationType:C,endpoint:r,orgUuid:S.uuid,conversationUuid:n,body:{organization_uuid:S.uuid,conversation_uuid:n,text:t,attachments:o,files:l.map(e=>e.file_uuid),sync_sources:u.map(e=>e.uuid),..."string"==typeof v&&{org_type_override:v}},onCompletion:e=>{i(n,e),I=e},onInvokeTool:s,abortController:x,completion:y,getTools:a,smoothingEnabled:!T&&!e})).stopReason,M=D.messageLimitResult,D&&!O)throw q}catch(e){if(ee({prompt:t,attachments:o,files:l}),e===q?(i(n,I),er(X,o.length+l.length,l.filter(e=>"document"===e.file_kind).length),ea.track({event_key:"sse_interrupted"}),(0,b.uT)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))):er(e,o.length+l.length,l.filter(e=>"document"===e.file_kind).length),(0,b.Tb)(e),c||(0,k.yG)())throw e}finally{await en(M)}return I},[P,S,B,ee,H,Q,W,a,N,ei,C,r,n,s,T,i,er,en,ea,es]),el=(0,I.useCallback)(()=>{P&&(P.controller.abort(),en(null))},[P,en]);return{runStream:eo,isStreaming:!!P,abortStream:el}}},78230:function(e,t,n){n.d(t,{h:function(){return i},l:function(){return s}});var r=n(7653);let a="customSystemPrompt",i=()=>{let[e,t]=(0,r.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)||"");return(0,r.useEffect)(()=>{localStorage.setItem(a,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},s=()=>"undefined"==typeof localStorage?"":localStorage.getItem(a)},49185:function(e,t,n){n.d(t,{I:function(){return d},n:function(){return c}});var r=n(5362),a=n(27218),i=n(48410),s=n(13262),o=n(87033),l=n(77930),u=n(7653);let c=()=>{let e=(0,l.useQueryClient)();return(0,u.useCallback)((t,n,r)=>{"within_limit"!==t.type&&(t.conversationUUID=r),e.setQueryData([s.aY],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},d=e=>{let{activeOrganization:t}=(0,a.t)(),{selectedTier:n}=(0,i.i)(),{value:s}=(0,o.FL)("internal_tier_selector"),l=null==t?void 0:t.uuid,u=c(),d={type:"within_limit"};return(0,r.uC)(()=>"/api/organizations/".concat(l,"/reset_rate_limits"),"POST",{onSuccess:()=>{u(d,l,e||"")},meta:{noToast:!0},transformVariables:()=>s&&n?{org_type:n}:{}})}},57271:function(e,t,n){n.d(t,{p:function(){return u}});var r=n(27218),a=n(13262),i=n(77930),s=n(7653),o=n(1146),l=n(49185);let u=()=>{let e=(0,i.useQueryClient)(),{activeOrganization:t}=(0,r.t)(),n=null==t?void 0:t.uuid,u=(0,s.useRef)(),c=(0,l.n)(),d=(0,s.useCallback)(async(t,r)=>{let i=[a.I8,{orgUUID:n},{uuid:t}],s=e.getQueryData(i);if(!s)throw Error("Conversation tree must be provided for append");let o=r(s);u.current=o,await e.cancelQueries({queryKey:i}),e.setQueryData(i,u.current)},[e,n]),h=(0,s.useCallback)((t,r)=>{0!==r.length&&e.setQueryData([a.I8,{orgUUID:n},{uuid:t}],()=>{let e=u.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=r,{...e,created_at:new Date().toISOString()}})},[e,n]);return{onStartAppend:d,onStreamCompleted:(0,s.useCallback)((t,r)=>{e.invalidateQueries({queryKey:[a.I8,{orgUUID:n}]}),e.invalidateQueries({queryKey:[a.tv,{orgUUID:n}]}),e.invalidateQueries({queryKey:[a.Dn,{orgUUID:n}]}),r&&n&&c(r,n,t)},[e,c,n]),onIncrementalCompletion:h,changeDisplayedConversationPath:(0,s.useCallback)((t,r,i,s)=>{e.setQueryData([a.I8,{orgUUID:n},{uuid:t}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let t=(0,o.mj)(e,r,i);return t.current_leaf_message_uuid&&s&&s(t.current_leaf_message_uuid),t})},[e,n])}}},66092:function(e,t,n){n.d(t,{$:function(){return i}});var r=n(7653),a=n(18013);function i(){let[e,t]=(0,a.R)("mcp-enabled-tools",{}),n=(0,r.useCallback)((e,n)=>{Array.isArray(e)?t(t=>({...t,...e.reduce((e,t)=>({...e,[t]:n}),{})})):t(t=>({...t,[e]:n}))},[t]),i=(0,r.useCallback)(t=>!!e[t],[e]),s=(0,r.useCallback)(()=>{let t=Object.entries(e).filter(e=>{let[t,n]=e;return n}).map(e=>{let[t]=e;return t});return 0===t.length?[]:t.map(e=>({type:"remote_mcp_v0",name:e.split(":").slice(-1)[0]}))},[e]);return{enabledTools:e,setEnabledTools:t,toggleTool:n,isToolEnabled:i,getRemoteMcpTools:s}}},48410:function(e,t,n){n.d(t,{TierSelectorProvider:function(){return d},i:function(){return c}});var r=n(27573),a=n(6385),i=n(87033),s=n(98649),o=n(7653),l=n(40287);let u=(0,o.createContext)(null),c=()=>{let e=(0,o.useContext)(u);if(!e)throw Error("useTierSelector must be used within a TierSelectorProvider");return e},d=e=>{var t;let{children:n,initialEnabled:c=!1}=e,d=(0,l.f)(),[h,p]=(0,o.useState)(()=>d.get(a.cn.SELECTED_TIER)||null),m=null!==(t=(0,i.FL)("internal_tier_selector").value)&&void 0!==t?t:c,_=(0,o.useState)(m)[1],f=(0,o.useCallback)(()=>{let e=[s.kQ.FREE,s.kQ.PRO,s.kQ.ENTERPRISE,s.kQ.MAX],t=Math.floor(Math.random()*e.length);return e[t]},[]),g=(0,o.useCallback)(e=>{if(!m){p(e);return}if(null===e){let e=h||f();d.set(a.cn.SELECTED_TIER,e,{maxAgeSeconds:2592e3})}else d.set(a.cn.SELECTED_TIER,e);p(e)},[h,p,d,f,m]);return(0,o.useEffect)(()=>{m?h&&d.set(a.cn.SELECTED_TIER,h):d.delete(a.cn.SELECTED_TIER)},[m,h,d]),(0,r.jsx)(u.Provider,{value:{selectedTier:h,isTierSelectorEnabled:m,setSelectedTier:g,setIsTierSelectorEnabled:_},children:n})}},72358:function(e,t,n){n.d(t,{GN:function(){return o},Y_:function(){return l},Yr:function(){return c},ZW:function(){return s},g2:function(){return u}});var r=n(79939),a=n.n(r),i=n(68571);a().join(i.cwd(),"public/i18n"),a().join(i.cwd(),"public/i18n/secret");let s="en-US",o={"xx-LS":{name:"Long stringsSSSSSSSS"},"xx-AC":{name:"ALL CAPS"},"xx-HA":{name:"[javascript] prefixed strings"},"en-XA":{name:"Ȧȧƈƈḗḗƞŧḗḗḓ Ḗḗƞɠŀīīşħ"},"en-XB":{name:"ɥsıʅƃuƎ ıpıԐ"}};function l(e){return"".concat("secret",":").concat(e)}function u(e){return"".concat("statsig",":").concat(e)}Object.keys(o);let c=["en-US","de-DE","fr-FR","ko-KR","ja-JP","es-419","es-ES","it-IT","hi-IN","pt-BR","id-ID"]},66894:function(e,t,n){n.d(t,{Ry:function(){return i},yG:function(){return r}}),n(68571);let r=()=>!1,a=()=>!1,i=()=>a()||r()}}]);